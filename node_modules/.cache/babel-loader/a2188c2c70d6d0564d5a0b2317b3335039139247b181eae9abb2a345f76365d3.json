{"ast":null,"code":"export const createUnhandledRejection = (emitNotSupportedError, window, wrapSubscribeFunction) => {\n  return coolingOffPeriod => wrapSubscribeFunction(observer => {\n    if (window === null || window.clearInterval === undefined || window.setInterval === undefined) {\n      return emitNotSupportedError(observer);\n    }\n    const possiblyUnhandledRejections = new Map();\n    let intervalId = null;\n    const deletePossiblyUnhandledRejection = _ref => {\n      let {\n        promise\n      } = _ref;\n      return possiblyUnhandledRejections.delete(promise);\n    };\n    const emitUnhandledRejection = () => {\n      const latestTimestampToEmit = Date.now() - coolingOffPeriod;\n      possiblyUnhandledRejections.forEach((_ref2, promise) => {\n        let {\n          reason,\n          timestamp\n        } = _ref2;\n        if (timestamp > latestTimestampToEmit) {\n          return;\n        }\n        possiblyUnhandledRejections.delete(promise);\n        observer.next(reason);\n      });\n      if (intervalId !== null && possiblyUnhandledRejections.size === 0) {\n        window.clearInterval(intervalId);\n        intervalId = null;\n      }\n    };\n    const registerPossiblyUnhandledRejection = event => {\n      event.preventDefault();\n      possiblyUnhandledRejections.set(event.promise, {\n        reason: event.reason,\n        timestamp: Date.now()\n      });\n      if (intervalId === null) {\n        intervalId = window.setInterval(emitUnhandledRejection, coolingOffPeriod / 2);\n      }\n    };\n    window.addEventListener('rejectionhandled', deletePossiblyUnhandledRejection);\n    window.addEventListener('unhandledrejection', registerPossiblyUnhandledRejection);\n    return () => {\n      if (intervalId !== null) {\n        window.clearInterval(intervalId);\n      }\n      window.removeEventListener('rejectionhandled', deletePossiblyUnhandledRejection);\n      window.removeEventListener('unhandledrejection', registerPossiblyUnhandledRejection);\n    };\n  });\n};","map":{"version":3,"names":["createUnhandledRejection","emitNotSupportedError","window","wrapSubscribeFunction","coolingOffPeriod","observer","clearInterval","undefined","setInterval","possiblyUnhandledRejections","Map","intervalId","deletePossiblyUnhandledRejection","_ref","promise","delete","emitUnhandledRejection","latestTimestampToEmit","Date","now","forEach","_ref2","reason","timestamp","next","size","registerPossiblyUnhandledRejection","event","preventDefault","set","addEventListener","removeEventListener"],"sources":["/Users/neelpatel/Desktop/react_application/pushup_counter/node_modules/subscribable-things/src/factories/unhandled-rejection.ts"],"sourcesContent":["import { TUnhandledRejectionFactory } from '../types';\n\nexport const createUnhandledRejection: TUnhandledRejectionFactory = (emitNotSupportedError, window, wrapSubscribeFunction) => {\n    return (coolingOffPeriod) =>\n        wrapSubscribeFunction((observer) => {\n            if (window === null || window.clearInterval === undefined || window.setInterval === undefined) {\n                return emitNotSupportedError(observer);\n            }\n\n            const possiblyUnhandledRejections = new Map<Promise<any>, { reason: any; timestamp: number }>();\n\n            let intervalId: null | number = null;\n\n            const deletePossiblyUnhandledRejection = ({ promise }: PromiseRejectionEvent) => possiblyUnhandledRejections.delete(promise);\n            const emitUnhandledRejection = () => {\n                const latestTimestampToEmit = Date.now() - coolingOffPeriod;\n\n                possiblyUnhandledRejections.forEach(({ reason, timestamp }, promise) => {\n                    if (timestamp > latestTimestampToEmit) {\n                        return;\n                    }\n\n                    possiblyUnhandledRejections.delete(promise);\n                    observer.next(reason);\n                });\n\n                if (intervalId !== null && possiblyUnhandledRejections.size === 0) {\n                    window.clearInterval(intervalId);\n                    intervalId = null;\n                }\n            };\n            const registerPossiblyUnhandledRejection = (event: PromiseRejectionEvent) => {\n                event.preventDefault();\n\n                possiblyUnhandledRejections.set(event.promise, {\n                    reason: event.reason,\n                    timestamp: Date.now()\n                });\n\n                if (intervalId === null) {\n                    intervalId = window.setInterval(emitUnhandledRejection, coolingOffPeriod / 2);\n                }\n            };\n\n            window.addEventListener('rejectionhandled', deletePossiblyUnhandledRejection);\n            window.addEventListener('unhandledrejection', registerPossiblyUnhandledRejection);\n\n            return () => {\n                if (intervalId !== null) {\n                    window.clearInterval(intervalId);\n                }\n\n                window.removeEventListener('rejectionhandled', deletePossiblyUnhandledRejection);\n                window.removeEventListener('unhandledrejection', registerPossiblyUnhandledRejection);\n            };\n        });\n};\n"],"mappings":"AAEA,OAAO,MAAMA,wBAAwB,GAA+BA,CAACC,qBAAqB,EAAEC,MAAM,EAAEC,qBAAqB,KAAI;EACzH,OAAQC,gBAAgB,IACpBD,qBAAqB,CAAEE,QAAQ,IAAI;IAC/B,IAAIH,MAAM,KAAK,IAAI,IAAIA,MAAM,CAACI,aAAa,KAAKC,SAAS,IAAIL,MAAM,CAACM,WAAW,KAAKD,SAAS,EAAE;MAC3F,OAAON,qBAAqB,CAACI,QAAQ,CAAC;;IAG1C,MAAMI,2BAA2B,GAAG,IAAIC,GAAG,EAAoD;IAE/F,IAAIC,UAAU,GAAkB,IAAI;IAEpC,MAAMC,gCAAgC,GAAGC,IAAA;MAAA,IAAC;QAAEC;MAAO,CAAyB,GAAAD,IAAA;MAAA,OAAKJ,2BAA2B,CAACM,MAAM,CAACD,OAAO,CAAC;IAAA;IAC5H,MAAME,sBAAsB,GAAGA,CAAA,KAAK;MAChC,MAAMC,qBAAqB,GAAGC,IAAI,CAACC,GAAG,EAAE,GAAGf,gBAAgB;MAE3DK,2BAA2B,CAACW,OAAO,CAAC,CAAAC,KAAA,EAAwBP,OAAO,KAAI;QAAA,IAAlC;UAAEQ,MAAM;UAAEC;QAAS,CAAE,GAAAF,KAAA;QACtD,IAAIE,SAAS,GAAGN,qBAAqB,EAAE;UACnC;;QAGJR,2BAA2B,CAACM,MAAM,CAACD,OAAO,CAAC;QAC3CT,QAAQ,CAACmB,IAAI,CAACF,MAAM,CAAC;MACzB,CAAC,CAAC;MAEF,IAAIX,UAAU,KAAK,IAAI,IAAIF,2BAA2B,CAACgB,IAAI,KAAK,CAAC,EAAE;QAC/DvB,MAAM,CAACI,aAAa,CAACK,UAAU,CAAC;QAChCA,UAAU,GAAG,IAAI;;IAEzB,CAAC;IACD,MAAMe,kCAAkC,GAAIC,KAA4B,IAAI;MACxEA,KAAK,CAACC,cAAc,EAAE;MAEtBnB,2BAA2B,CAACoB,GAAG,CAACF,KAAK,CAACb,OAAO,EAAE;QAC3CQ,MAAM,EAAEK,KAAK,CAACL,MAAM;QACpBC,SAAS,EAAEL,IAAI,CAACC,GAAG;OACtB,CAAC;MAEF,IAAIR,UAAU,KAAK,IAAI,EAAE;QACrBA,UAAU,GAAGT,MAAM,CAACM,WAAW,CAACQ,sBAAsB,EAAEZ,gBAAgB,GAAG,CAAC,CAAC;;IAErF,CAAC;IAEDF,MAAM,CAAC4B,gBAAgB,CAAC,kBAAkB,EAAElB,gCAAgC,CAAC;IAC7EV,MAAM,CAAC4B,gBAAgB,CAAC,oBAAoB,EAAEJ,kCAAkC,CAAC;IAEjF,OAAO,MAAK;MACR,IAAIf,UAAU,KAAK,IAAI,EAAE;QACrBT,MAAM,CAACI,aAAa,CAACK,UAAU,CAAC;;MAGpCT,MAAM,CAAC6B,mBAAmB,CAAC,kBAAkB,EAAEnB,gCAAgC,CAAC;MAChFV,MAAM,CAAC6B,mBAAmB,CAAC,oBAAoB,EAAEL,kCAAkC,CAAC;IACxF,CAAC;EACL,CAAC,CAAC;AACV,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}